generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model Member {
  id              String        @id @default(uuid())
  memberNumber    String        @unique
  nationalId      String        @unique
  password        String
  fullNameAr      String
  fullNameEn      String
  governorate     String
  memberType      MemberType
  entityName      String
  role            String
  profileImage    String
  paymentMethod   PaymentMethod
  coordinatorName String?
  instapayRef     String?
  amountPaid      Float?
  paymentReceipt  String?
  qrCode          String
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt

  attendances     Attendance[]
}

// Counter for generating sequential member numbers per governorate
model MemberCounter {
  id        String @id
  prefix    String @unique
  counter   Int    @default(5000)
}

enum MemberType {
  student
  graduate
}

model Admin {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String
  name      String   @default("مدير النظام")
  createdAt DateTime @default(now())

  createdEvents      Event[]
  scannedAttendances Attendance[] @relation("AttendanceScanner")
}

enum PaymentMethod {
  coordinator
  instapay
}

model Settings {
  id               String   @id @default("default")
  platformName     String   @default("عضويتي")
  platformSubtitle String   @default("اتحاد بشبابها")
  logoUrl          String?
  primaryColor     String   @default("#1e3a5f")
  membershipFee    Float    @default(0)
  instapayNumber   String?
  instapayName     String?
  enableRegistration Boolean @default(true)
  updatedAt        DateTime @updatedAt
}

// Event Categories
enum EventCategory {
  workshop      // ورشة عمل
  conference    // مؤتمر
  meeting       // اجتماع
  training      // تدريب
  seminar       // ندوة
  celebration   // احتفال
  sports        // رياضي
  cultural      // ثقافي
  other         // أخرى
}

// Events Model
model Event {
  id               String        @id @default(uuid())
  name             String
  description      String?
  category         EventCategory
  organizingEntity String
  location         String
  date             DateTime
  startTime        String
  endTime          String?
  isActive         Boolean       @default(true)
  createdBy        String
  createdAt        DateTime      @default(now())
  updatedAt        DateTime      @updatedAt

  attendances      Attendance[]
  creator          Admin         @relation(fields: [createdBy], references: [id])
}

// Attendance Model
model Attendance {
  id        String   @id @default(uuid())
  eventId   String
  memberId  String
  scannedBy String
  scannedAt DateTime @default(now())

  event     Event    @relation(fields: [eventId], references: [id], onDelete: Cascade)
  member    Member   @relation(fields: [memberId], references: [id], onDelete: Cascade)
  scanner   Admin    @relation("AttendanceScanner", fields: [scannedBy], references: [id])

  @@unique([eventId, memberId])
}
